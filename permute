#!/usr/bin/env python3
from itertools import product, permutations
import sys
import argparse

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-w', '--wordsonly', action='store_true', default=False)
    parser.add_argument('--min', action='store', default=None, type=int)
    parser.add_argument('--max', action='store', default=None, type=int)
    parser.add_argument('--no-replacement', action='store_true', default=False)
    parser.add_argument('string_to_permute', nargs='?', default=None)
    args = parser.parse_args()

    string_to_permute = args.string_to_permute or sys.stdin.read()

    if args.wordsonly:
        with open('/usr/share/dict/words') as wordlist:
            filter_set = {line.strip().lower() for line in wordlist}
    else:
        filter_set = None

    min_length = args.min or len(string_to_permute)
    max_length = args.max or len(string_to_permute)

    for length in range(min_length, max_length + 1):
        for perm in generate(string_to_permute, length, args.no_replacement):
            word = ''.join(perm)

            if not filter_set:
                print(word)
                sys.stdout.flush()
            elif word in filter_set:
                print(word)
                sys.stdout.flush()

def generate(string_to_permute, length, no_replacement):
    if no_replacement:
        return permutations(string_to_permute, length)
    else:
        return product(string_to_permute, repeat=length)



if __name__ == '__main__':
    main()
