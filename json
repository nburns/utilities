#!/usr/bin/env python3
import sys
import functools
import argparse

try:
    import simplejson
except ImportError:
    sys.exit('pip install simplejson')


stderr = functools.partial(print, file=sys.stderr)


def error_print(data, error):
    stderr('\n{}\n'.format(error))
    line = data.split('\n')[error.lineno - 1]
    error_line = [
            '^' if error.colno - 1 == i else '-' for i, c in enumerate(line)]
    stderr(line)
    stderr(''.join(error_line))


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-k', '--keys-only', action='store_true', default=False)
    parser.add_argument('-d', '--data', type=str, default=None)
    args = parser.parse_args()

    if args.data:
        data = args.data
    else:
        data = sys.stdin.read()

    try:
        parsed = simplejson.loads(data)
    except simplejson.JSONDecodeError as e:
        error_print(data, e)
        sys.exit(71)

    if args.keys_only:
        for k in parsed.keys():
            print(k)
    else:
        print(
            simplejson.dumps(
                parsed,
                ensure_ascii=False,
                sort_keys=True,
                indent=4,
                separators=(',', ': ')
            )
        )
        
if __name__ == '__main__':
    main()
